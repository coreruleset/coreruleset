---
meta:
  author: "Andrea Menin (theMiddle)"
  description: JSON in SQL bypass technique
  enabled: true
  name: 942550.yaml
tests:
  - test_title: 942550-1
    desc: "PostgreSQL JSON in SQL"
    stages:
      - stage:
          input:
            dest_addr: 127.0.0.1
            headers:
              Host: localhost
              User-Agent: OWASP ModSecurity Core Rule Set
              Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
            method: POST
            port: 80
            uri: "/"
            # id=1+OR+'{"a":1}'/**/::/**/jSonb/**/<@'{"a":1}'::jsonb
            data: "id=1+OR+%27%7B%22a%22%3A1%7D%27%2F%2A%2A%2F%3A%3A%2F%2A%2A%2FjSonb%2F%2A%2A%2F%3C%40%27%7B%22a%22%3A1%7D%27%3A%3Ajsonb"
            version: HTTP/1.0
          output:
            log_contains: id "942550"
  - test_title: 942550-2
    desc: "SQLite JSON in SQL"
    stages:
      - stage:
          input:
            dest_addr: 127.0.0.1
            headers:
              Host: localhost
              User-Agent: OWASP ModSecurity Core Rule Set
              Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
            method: POST
            port: 80
            uri: "/"
            # id=1+OR+'{"a":2,"c":[4,5,{"f":7}]}' -> '$.c[2].f'=7
            data: "id=1+OR+%27%7B%22a%22%3A2%2C%22c%22%3A%5B4%2C5%2C%7B%22f%22%3A7%7D%5D%7D%27%20-%3E%20%27%24.c%5B2%5D.f%27%3D7"
            version: HTTP/1.0
          output:
            log_contains: id "942550"
  - test_title: 942550-3
    desc: "MySQL JSON in SQL"
    stages:
      - stage:
          input:
            dest_addr: 127.0.0.1
            headers:
              Host: localhost
              User-Agent: OWASP ModSecurity Core Rule Set
              Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
            method: POST
            port: 80
            uri: "/"
            # id=1+OR+1=JsoN_EXTraCT/**/(/**/'  {"a":1}  '/**/,/**/' $.a '/**/)
            data: "id=1+OR+1%3DJsoN_EXTraCT%2F%2A%2A%2F%28%2F%2A%2A%2F%27%20%20%7B%22a%22%3A1%7D%20%20%27%2F%2A%2A%2F%2C%2F%2A%2A%2F%27%20%24.a%20%27%2F%2A%2A%2F%29"
            version: HTTP/1.0
          output:
            log_contains: id "942550"

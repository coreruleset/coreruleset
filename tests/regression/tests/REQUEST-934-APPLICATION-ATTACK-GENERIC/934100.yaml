---
meta:
  author: "lifeforms, airween, Max Leske, azurit, Andrew Howe, touchweb_vincent"
rule_id: 934100
tests:
  - test_id: 1
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=_%24%24ND_FUNC%24%24_"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 2
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=__js_function"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 3
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=eval%28String.fromCharCode"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 4
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=function%28%29+%7B"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 5
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=new+Function+%28"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 6
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=this.constructor.constructor"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 7
    desc: imported test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=module.exports%3D"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 8
    desc: base64 encoded test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=XyQkTkRfRlVOQyQkXwo="
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 9
    desc: base64 encoded test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=XyQkTkRfRlVOQyQkXwo="
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 10
    desc: process.env test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=process.env"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 11
    desc: console.info test
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=console.info(1)"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 12
    desc: console.info test (JavaScript escape sequences)
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=c%5Cu006fnsole.info(1)"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 13
    desc: process.env test (square bracket property access)
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: '/get?foo=process["env"]'
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 14
    desc: console.info test (square bracket property access)
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: '/get?foo=console["info"](1)'
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 15
    desc: console.info test (call method)
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=console.info.call(this,1)"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 16
    desc: '"process" false positive test'
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=process."
          version: HTTP/1.1
        output:
          log:
            no_expect_ids: [934100]
  - test_id: 17
    desc: '"console" false positive test'
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=console."
          version: HTTP/1.1
        output:
          log:
            no_expect_ids: [934100]
  - test_id: 18
    desc: ssti test 1
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=%23%7Bprocess.binding%28foo%29.spawn%28foo2%29%7D"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 19
    desc: ssti test 2
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=%23%7Brequire.main.constructor._load%28foo%29.readdirSync%28foo2%29%7D"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 20
    desc: ssti test 3
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=process%5Breq.query.a"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 21
    desc: ssti test 4
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=require%5Breq.query.a"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 22
    desc: ssti test 5
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: "/get?foo=process%5BmainModule"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 23
    desc: require child_process
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: GET
          port: 80
          uri: /get?foo=require("child_process").exec('whoami')
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 24
    desc: "5ZLKNU33"
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: POST
          port: 80
          data: |
            process.env
          uri: "/post"
          version: "HTTP/1.1"
        output:
          log:
            expect_ids: [934100]
  - test_id: 25
    desc: "5ZLKNU33"
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: POST
          port: 80
          data: |
            console.info(1)
          uri: "/post"
          version: "HTTP/1.1"
        output:
          log:
            expect_ids: [934100]
  - test_id: 26
    desc: "5ZLKNU33"
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Accept: "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"
            Host: localhost
            User-Agent: "OWASP CRS test agent"
          method: POST
          port: 80
          data: |
            c\u006fnsole.info(1)
          uri: "/post"
          version: "HTTP/1.1"
        output:
          log:
            expect_ids: [934100]
  - test_id: 27
    desc: "Detect example function _$$ND_FUNC$$_ submitted as plaintext"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
            Cookie: 'test_cookie=_$$ND_FUNC$$_function()'
          method: GET
          uri: "/get"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 28
    desc: "Detect example function _$$ND_FUNC$$_ submitted as plaintext with JavaScript escape sequence obfuscation"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
            Cookie: 'test_cookie=_$$\u004e\u0044_FUNC$$_\u0066unction()'
          method: GET
          uri: "/get"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 29
    desc: "Detect example function _$$ND_FUNC$$_ submitted as plaintext that has been Base64 encoded"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
            Cookie: 'test_cookie=XyQkTkRfRlVOQyQkX2Z1bmN0aW9uKCkK'
          method: GET
          uri: "/get"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 30
    desc: "Detect example function _$$ND_FUNC$$_ submitted as plaintext with JavaScript escape sequence obfuscation that has been Base64 encoded"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
            Cookie: 'test_cookie=XyQkXHUwMDRlXHUwMDQ0X0ZVTkMkJF9cdTAwNjZ1bmN0aW9uKCkK'
          method: GET
          uri: "/get"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 31
    desc: "Detect example function _$$ND_FUNC$$_ submitted as plaintext that has been Base64 encoded and then obfuscated with JavaScript escape sequences"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
            Cookie: 'test_cookie=\u0058\u0079QkTkRfRlVOQyQkX2Z1bmN0aW9uKCkK'
          method: GET
          uri: "/get"
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 32
    desc: "Detect CVE-2025-55182 payload from public POC"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
          method: GET
          uri: "/get?test=%7B%27_prefix%27%3A%27console.log%287%2A7%2B1%29%2F%2F%27%2C+%27_formData%27%3A%7B%27get%27%3A%27%243%3Aconstructor%3Aconstructor%27%7D%2C+%27_chunks%27%3A%27%242%3A_response%3A_chunks%27%2C%7D"
          # {'_prefix':'console.log(7*7+1)//',+'_formData':{'get':'$3:constructor:constructor'},+'_chunks':'$2:_response:_chunks',}
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 33
    desc: "Detect CVE-2025-55182 payload from public POC"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
          method: GET
          uri: "/get?test=%7B%22status%22%3A%22resolved_model%22%2C%20%22reason%22%3A%7B%220%22%3A%22%247%3AModule%3Aprototype%22%2C%20%22length%22%3A1%2C%20%22toString%22%3A%20%22%24b%3Apop%22%7D%2C%20%22_response%22%3A%20%22%249%22%2C%20%22value%22%3A%20%22%7B%5C%22set%5C%22%3A%5C%22%247%3AModule%3Aprototype%3A_compile%5C%22%2C%5C%22then%5C%22%3A%5C%22%24b%3Amap%5C%22%2C%5C%220%5C%22%3A%5C%22%2411%5C%22%2C%5C%22length%5C%22%3A1%7D%22%2C%20%22then%22%3A%22%242%3Athen%22%7D%27"
          # {"status":"resolved_model", "reason":{"0":"$7:Module:prototype", "length":1, "toString": "$b:pop"}, "_response": "$9", "value": "{\"set\":\"$7:Module:prototype:_compile\",\"then\":\"$b:map\",\"0\":\"$11\",\"length\":1}", "then":"$2:then"}'
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
  - test_id: 34
    desc: "Detect CVE-2025-55182 payload from TW SIEM"
    stages:
      - input:
          dest_addr: 127.0.0.1
          port: 80
          headers:
            Host: localhost
            User-Agent: "OWASP CRS test agent"
            Accept: "*/*"
          method: GET
          uri: "/get?test=%7B%22then%22%3A%22%241%3A__proto__%3Athen%22%2C%22status%22%3A%22resolved_model%22%2C%22reason%22%3A-1%2C%22value%22%3A%22%7B%5C%22then%5C%22%3A%5C%22%24B1337%5C%22%7D%22%2C%22_response%22%3A%7B%22_prefix%22%3A%22var+res%3Dprocess.mainModule.require%28%27child_process%27%29.execSync%28%27echo+%24%28%2841%2A271%29%29%27%29.toString%28%29.trim%28%29%3B%3Bthrow+Object.assign%28new+Error%28%27NEXT_REDIRECT%27%29%2C%7Bdigest%3A+%60NEXT_REDIRECT%3Bpush%3B%2Flogin%3Fa%3D%24%7Bres%7D%3B307%3B%60%7D%29%3B%22%2C%22_chunks%22%3A%22%24Q2%22%2C%22_formData%22%3A%7B%22get%22%3A%22%241%3Aconstructor%3Aconstructor%22%7D%7D%7D"
          # {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('echo $((41*271))').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
          version: HTTP/1.1
        output:
          log:
            expect_ids: [934100]
